<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Runtime and interpreter for MicroFactor bytecode</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">MicroFactor.Interpreter</span><span>
</span><a name="line-3"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="MicroFactor.Interpreter.html#interpret"><span class="hs-identifier hs-var">interpret</span></a><span>
</span><a name="line-4"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterError"><span class="hs-identifier hs-type">InterpreterError</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-5"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadState"><span class="hs-identifier hs-type">ThreadState</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-type">InterpreterResult</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-type">Thread</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="MicroFactor.Interpreter.html#newThread"><span class="hs-identifier hs-var">newThread</span></a><span>
</span><a name="line-9"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="MicroFactor.Interpreter.html#showValue"><span class="hs-identifier hs-var">showValue</span></a><span>
</span><a name="line-10"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="MicroFactor.Data.html"><span class="hs-identifier">MicroFactor.Data</span></a><span>
</span><a name="line-13"></a><span>
</span><a name="line-14"></a><span class="hs-comment">-- | Things that can go wrong during interpretion</span><span>
</span><a name="line-15"></a><span class="hs-keyword">data</span><span> </span><a name="InterpreterError"><a href="MicroFactor.Interpreter.html#InterpreterError"><span class="hs-identifier">InterpreterError</span></a></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-comment">-- | an attempt was made to pop from the empty (data) stack</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="StackUnderflow"><a href="MicroFactor.Interpreter.html#StackUnderflow"><span class="hs-identifier">StackUnderflow</span></a></a><span>
</span><a name="line-18"></a><span>    </span><span class="hs-comment">-- StackOverflow - cannot happen with Haskell's arbitrarily long lists :-)</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-comment">-- | an operation required an `Instruction` but was given some other value</span><span>
</span><a name="line-20"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="InvalidExecutionToken"><a href="MicroFactor.Interpreter.html#InvalidExecutionToken"><span class="hs-identifier">InvalidExecutionToken</span></a></a><span>
</span><a name="line-21"></a><span>    </span><span class="hs-comment">-- | some other operation did get the wrong operands</span><span>
</span><a name="line-22"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="TypeError"><a href="MicroFactor.Interpreter.html#TypeError"><span class="hs-identifier">TypeError</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-23"></a><span>        </span><span class="hs-comment">-- TODO: CouldNotSuspend</span><span>
</span><a name="line-24"></a><span>    </span><span class="hs-comment">-- TODO: InfiniteLoop</span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-comment">-- | Possible state for cooperative threads (not yet implemented)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">data</span><span> </span><a name="ThreadState"><a href="MicroFactor.Interpreter.html#ThreadState"><span class="hs-identifier">ThreadState</span></a></a><span>
</span><a name="line-29"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="Running"><a href="MicroFactor.Interpreter.html#Running"><span class="hs-identifier">Running</span></a></a><span> </span><span class="hs-comment">-- or done, if nothing on return stack</span><span>
</span><a name="line-30"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Delayed"><a href="MicroFactor.Interpreter.html#Delayed"><span class="hs-identifier">Delayed</span></a></a><span>
</span><a name="line-31"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Yielded"><a href="MicroFactor.Interpreter.html#Yielded"><span class="hs-identifier">Yielded</span></a></a><span>
</span><a name="line-32"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Waiting"><a href="MicroFactor.Interpreter.html#Waiting"><span class="hs-identifier">Waiting</span></a></a><span>
</span><a name="line-33"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">-- | A structure representing a cooperative thread (that might be suspended)</span><span>
</span><a name="line-36"></a><span class="hs-keyword">data</span><span> </span><a name="Thread"><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier">Thread</span></a></a><span> </span><a name="local-6989586621679034416"><a href="#local-6989586621679034416"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Thread"><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier">Thread</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-37"></a><span>    </span><span class="hs-comment">-- TODO: stopPending :: Bool,</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-comment">-- TODO: stopCritical :: Bool,</span><span>
</span><a name="line-39"></a><span>    </span><a name="state"><a href="MicroFactor.Interpreter.html#state"><span class="hs-identifier">state</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadState"><span class="hs-identifier hs-type">ThreadState</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>    </span><a name="dataStack"><a href="MicroFactor.Interpreter.html#dataStack"><span class="hs-identifier">dataStack</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="MicroFactor.Data.html#TaggedValue"><span class="hs-identifier hs-type">TaggedValue</span></a><span> </span><a href="#local-6989586621679034416"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>    </span><a name="returnStack"><a href="MicroFactor.Interpreter.html#returnStack"><span class="hs-identifier">returnStack</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679034416"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">]</span><span>
</span><a name="line-42"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-comment">-- | A fresh new thread, ready to run instructions</span><span>
</span><a name="line-45"></a><span class="hs-identifier">newThread</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-type">Thread</span></a><span> </span><a href="#local-6989586621679034526"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-46"></a><a name="newThread"><a href="MicroFactor.Interpreter.html#newThread"><span class="hs-identifier">newThread</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-var">Thread</span></a><span> </span><span class="hs-comment">{- False False -}</span><span> </span><a href="MicroFactor.Interpreter.html#Running"><span class="hs-identifier hs-var">Running</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-comment">-- | The result of executing instructions</span><span>
</span><a name="line-49"></a><span class="hs-keyword">data</span><span> </span><a name="InterpreterResult"><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier">InterpreterResult</span></a></a><span> </span><a name="local-6989586621679034270"><a href="#local-6989586621679034270"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679034271"><a href="#local-6989586621679034271"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="InterpreterResult"><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier">InterpreterResult</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-50"></a><span>    </span><a name="interpreterOutput"><a href="MicroFactor.Interpreter.html#interpreterOutput"><span class="hs-identifier">interpreterOutput</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ debug and `Send` output from the execution</span><span>
</span><a name="line-51"></a><span>    </span><a name="interpreterThread"><a href="MicroFactor.Interpreter.html#interpreterThread"><span class="hs-identifier">interpreterThread</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-type">Thread</span></a><span> </span><a href="#local-6989586621679034270"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ the new state of the thread</span><span>
</span><a name="line-52"></a><span>    </span><a name="interpreterValue"><a href="MicroFactor.Interpreter.html#interpreterValue"><span class="hs-identifier">interpreterValue</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterError"><span class="hs-identifier hs-type">InterpreterError</span></a><span> </span><a href="#local-6989586621679034271"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ the result value of the current step</span><span>
</span><a name="line-53"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-type">InterpreterResult</span></a><span> </span><a href="#local-6989586621679034440"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-56"></a><span>    </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><a name="local-6989586621679034441"><a href="#local-6989586621679034441"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679034442"><a href="#local-6989586621679034442"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679034442"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">interpreterValue</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679034441"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier">interpreterValue</span><span> </span><a href="#local-6989586621679034442"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-57"></a><span>
</span><a name="line-58"></a><span class="hs-comment">-- | A monadic interpreter, representing a piece of code that can be executed on a thread</span><span>
</span><a name="line-59"></a><span class="hs-keyword">newtype</span><span> </span><a name="ThreadInterpreter"><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier">ThreadInterpreter</span></a></a><span> </span><a name="local-6989586621679034268"><a href="#local-6989586621679034268"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679034269"><a href="#local-6989586621679034269"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ThreadInterpreter"><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier">ThreadInterpreter</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-60"></a><span>    </span><a name="runInterpreter"><a href="MicroFactor.Interpreter.html#runInterpreter"><span class="hs-identifier">runInterpreter</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-type">Thread</span></a><span> </span><a href="#local-6989586621679034268"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-type">InterpreterResult</span></a><span> </span><a href="#local-6989586621679034268"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679034269"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-61"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Functor</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">-- instance Functor (ThreadInterpreter r) where</span><span>
</span><a name="line-64"></a><span class="hs-comment">--    fmap f = ThreadInterpreter . fmap (fmap f) . runInterpreter</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034437"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-67"></a><span>    </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span>
</span><a name="line-68"></a><span>    </span><a name="local-6989586621679034438"><a href="#local-6989586621679034438"><span class="hs-identifier">fi</span></a></a><span> </span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span> </span><a name="local-6989586621679034439"><a href="#local-6989586621679034439"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679034438"><span class="hs-identifier hs-var">fi</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier hs-var">fmap</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679034439"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034417"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-71"></a><span>    </span><a name="local-3458764513820541102"><span class="hs-identifier">return</span></a><span> </span><a name="local-6989586621679034421"><a href="#local-6989586621679034421"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034422"><a href="#local-6989586621679034422"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679034422"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679034421"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-special">(</span><span class="hs-operator">&gt;&gt;=</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679034418"><a href="#local-6989586621679034418"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679034419"><a href="#local-6989586621679034419"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679034420"><a href="#local-6989586621679034420"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034418"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679034419"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034419"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034418"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679034420"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034418"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679034420"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-73"></a><span>    </span><a name="local-6989586621679034423"><a href="#local-6989586621679034423"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621679034424"><a href="#local-6989586621679034424"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034425"><span class="hs-identifier hs-var">step</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">runInterpreter</span><span> </span><a href="#local-6989586621679034423"><span class="hs-identifier hs-var">m</span></a><span>
</span><a name="line-74"></a><span>        </span><span class="hs-keyword">where</span><span>
</span><a name="line-75"></a><span>            </span><span class="hs-identifier">step</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-type">InterpreterResult</span></a><span> </span><a href="#local-6989586621679034418"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679034419"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-type">InterpreterResult</span></a><span> </span><a href="#local-6989586621679034418"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679034420"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-76"></a><span>            </span><a name="local-6989586621679034425"><a href="#local-6989586621679034425"><span class="hs-identifier">step</span></a></a><span> </span><span class="hs-special">(</span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><a name="local-6989586621679034426"><a href="#local-6989586621679034426"><span class="hs-identifier">o1</span></a></a><span> </span><a name="local-6989586621679034427"><a href="#local-6989586621679034427"><span class="hs-identifier">t1</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679034428"><a href="#local-6989586621679034428"><span class="hs-identifier">x1</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-77"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><a name="local-6989586621679034429"><a href="#local-6989586621679034429"><span class="hs-identifier">o2</span></a></a><span> </span><a name="local-6989586621679034430"><a href="#local-6989586621679034430"><span class="hs-identifier">t2</span></a></a><span> </span><a name="local-6989586621679034431"><a href="#local-6989586621679034431"><span class="hs-identifier">x2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runInterpreter</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034424"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679034428"><span class="hs-identifier hs-var">x1</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679034427"><span class="hs-identifier hs-var">t1</span></a><span>
</span><a name="line-78"></a><span>                </span><span class="hs-keyword">in</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034426"><span class="hs-identifier hs-var">o1</span></a><span> </span><span class="hs-operator hs-var">&lt;&gt;</span><span> </span><a href="#local-6989586621679034429"><span class="hs-identifier hs-var">o2</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679034430"><span class="hs-identifier hs-var">t2</span></a><span> </span><a href="#local-6989586621679034431"><span class="hs-identifier hs-var">x2</span></a><span>
</span><a name="line-79"></a><span>            </span><span class="hs-comment">-- step interpreterLeftResult = interpreterLeftResult</span><span>
</span><a name="line-80"></a><span>            </span><span class="hs-identifier">step</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><a name="local-6989586621679034432"><a href="#local-6989586621679034432"><span class="hs-identifier">o</span></a></a><span> </span><a name="local-6989586621679034433"><a href="#local-6989586621679034433"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679034434"><a href="#local-6989586621679034434"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><a href="#local-6989586621679034432"><span class="hs-identifier hs-var">o</span></a><span> </span><a href="#local-6989586621679034433"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679034434"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>    </span><a name="local-3458764513820541098"><span class="hs-identifier">fail</span></a><span> </span><a name="local-6989586621679034435"><a href="#local-6989586621679034435"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034436"><a href="#local-6989586621679034436"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpreterFailResult"><span class="hs-identifier hs-var">interpreterFailResult</span></a><span> </span><a href="#local-6989586621679034436"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MicroFactor.Interpreter.html#TypeError"><span class="hs-identifier hs-var">TypeError</span></a><span> </span><a href="#local-6989586621679034435"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-84"></a><span>
</span><a name="line-85"></a><span class="hs-comment">-- fails and aborts the thread by truncating the return stack (i.e. no &quot;catching&quot;)</span><span>
</span><a name="line-86"></a><span class="hs-identifier">interpreterFailResult</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-type">Thread</span></a><span> </span><a href="#local-6989586621679034524"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterError"><span class="hs-identifier hs-type">InterpreterError</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-type">InterpreterResult</span></a><span> </span><a href="#local-6989586621679034524"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679034525"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-87"></a><a name="interpreterFailResult"><a href="MicroFactor.Interpreter.html#interpreterFailResult"><span class="hs-identifier">interpreterFailResult</span></a></a><span> </span><a name="local-6989586621679034527"><a href="#local-6989586621679034527"><span class="hs-identifier">t</span></a></a><span> </span><a name="local-6989586621679034528"><a href="#local-6989586621679034528"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679034527"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">returnStack</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><a href="#local-6989586621679034528"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-comment">-- put a value on the data stack</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- pushData :: TaggedValue r -&gt; Thread r -&gt; Thread r</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- pushData x (t@Thread {dataStack}) = t { dataStack = x:dataStack }</span><span>
</span><a name="line-92"></a><span class="hs-identifier">pushData</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Data.html#TaggedValue"><span class="hs-identifier hs-type">TaggedValue</span></a><span> </span><a href="#local-6989586621679034523"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034523"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><a name="pushData"><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier">pushData</span></a></a><span> </span><a name="local-6989586621679034529"><a href="#local-6989586621679034529"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034530"><a href="#local-6989586621679034530"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-var">Thread</span></a><span> </span><span class="hs-special">{</span><a name="local-6989586621679034531"><a href="#local-6989586621679034531"><span class="hs-identifier">dataStack</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-94"></a><span>    </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679034530"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dataStack</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679034529"><span class="hs-identifier hs-var">x</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034531"><span class="hs-identifier hs-var">dataStack</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-comment">-- remove a value from the data stack</span><span>
</span><a name="line-97"></a><span class="hs-identifier">popData</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034522"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#TaggedValue"><span class="hs-identifier hs-type">TaggedValue</span></a><span> </span><a href="#local-6989586621679034522"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-98"></a><a name="popData"><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier">popData</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034532"><a href="#local-6989586621679034532"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679034532"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-99"></a><span>    </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-var">Thread</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dataStack</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpreterFailResult"><span class="hs-identifier hs-var">interpreterFailResult</span></a><span> </span><a href="#local-6989586621679034532"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="MicroFactor.Interpreter.html#StackUnderflow"><span class="hs-identifier hs-var">StackUnderflow</span></a><span>
</span><a name="line-100"></a><span>    </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-var">Thread</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dataStack</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679034533"><a href="#local-6989586621679034533"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034534"><a href="#local-6989586621679034534"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679034532"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">dataStack</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679034534"><span class="hs-identifier hs-var">ds</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679034533"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- read the top value from the data stack</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- getData :: ThreadInterpreter r (TaggedValue r)</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- getData = popData &gt;&gt;= (pushData &gt;&gt;= ($&gt;))</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-identifier">popDataBool</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034521"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-107"></a><a name="popDataBool"><a href="MicroFactor.Interpreter.html#popDataBool"><span class="hs-identifier">popDataBool</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-108"></a><span>    </span><a name="local-6989586621679034535"><a href="#local-6989586621679034535"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span>
</span><a name="line-109"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679034535"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-110"></a><span>        </span><a href="MicroFactor.Data.html#Boolean"><span class="hs-identifier hs-var">Boolean</span></a><span> </span><a name="local-6989586621679034536"><a href="#local-6989586621679034536"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679034536"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-111"></a><span>        </span><a href="MicroFactor.Data.html#Integer"><span class="hs-identifier hs-var">Integer</span></a><span> </span><a name="local-6989586621679034537"><a href="#local-6989586621679034537"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034537"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>        </span><a name="local-6989586621679034538"><a href="#local-6989586621679034538"><span class="hs-identifier">x</span></a></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;expected Boolean (or Integer)&quot;</span><span> </span><span class="hs-comment">-- &quot;but got&quot; ++ show x</span><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-identifier">popDataInstruction</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034520"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#MicroFactorInstruction"><span class="hs-identifier hs-type">MicroFactorInstruction</span></a><span> </span><a href="#local-6989586621679034520"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><a name="popDataInstruction"><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier">popDataInstruction</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-116"></a><span>    </span><a name="local-6989586621679034539"><a href="#local-6989586621679034539"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span>
</span><a name="line-117"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679034539"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-118"></a><span>        </span><a href="MicroFactor.Data.html#Instruction"><span class="hs-identifier hs-var">Instruction</span></a><span> </span><a name="local-6989586621679034540"><a href="#local-6989586621679034540"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679034540"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-119"></a><span>        </span><span class="hs-identifier">_</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034541"><a href="#local-6989586621679034541"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpreterFailResult"><span class="hs-identifier hs-var">interpreterFailResult</span></a><span> </span><a href="#local-6989586621679034541"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="MicroFactor.Interpreter.html#InvalidExecutionToken"><span class="hs-identifier hs-var">InvalidExecutionToken</span></a><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-identifier">popDataInt</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034519"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-122"></a><a name="popDataInt"><a href="MicroFactor.Interpreter.html#popDataInt"><span class="hs-identifier">popDataInt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-123"></a><span>    </span><a name="local-6989586621679034542"><a href="#local-6989586621679034542"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span>
</span><a name="line-124"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679034542"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-125"></a><span>        </span><a href="MicroFactor.Data.html#Integer"><span class="hs-identifier hs-var">Integer</span></a><span> </span><a name="local-6989586621679034543"><a href="#local-6989586621679034543"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679034543"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-126"></a><span>        </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;expected Integer&quot;</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-identifier">interpretCompare</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679034518"><a href="#local-6989586621679034518"><span class="hs-identifier">c</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679034518"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679034518"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679034518"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034517"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><a name="interpretCompare"><a href="MicroFactor.Interpreter.html#interpretCompare"><span class="hs-identifier">interpretCompare</span></a></a><span> </span><a name="local-6989586621679034544"><a href="#local-6989586621679034544"><span class="hs-identifier">comp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-131"></a><span>    </span><a name="local-6989586621679034545"><a href="#local-6989586621679034545"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span>
</span><a name="line-132"></a><span>    </span><a name="local-6989586621679034546"><a href="#local-6989586621679034546"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span>
</span><a name="line-133"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034546"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679034545"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-134"></a><span>        </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Boolean"><span class="hs-identifier hs-var">Boolean</span></a><span> </span><a name="local-6989586621679034547"><a href="#local-6989586621679034547"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a href="MicroFactor.Data.html#Boolean"><span class="hs-identifier hs-var">Boolean</span></a><span> </span><a name="local-6989586621679034548"><a href="#local-6989586621679034548"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MicroFactor.Data.html#Boolean"><span class="hs-identifier hs-var">Boolean</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034544"><span class="hs-identifier hs-var">comp</span></a><span> </span><a href="#local-6989586621679034547"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679034548"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-135"></a><span>        </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Integer"><span class="hs-identifier hs-var">Integer</span></a><span> </span><a name="local-6989586621679034549"><a href="#local-6989586621679034549"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a href="MicroFactor.Data.html#Integer"><span class="hs-identifier hs-var">Integer</span></a><span> </span><a name="local-6989586621679034550"><a href="#local-6989586621679034550"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MicroFactor.Data.html#Boolean"><span class="hs-identifier hs-var">Boolean</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034544"><span class="hs-identifier hs-var">comp</span></a><span> </span><a href="#local-6989586621679034549"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679034550"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-136"></a><span>        </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#PortAddress"><span class="hs-identifier hs-var">PortAddress</span></a><span> </span><a name="local-6989586621679034551"><a href="#local-6989586621679034551"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a href="MicroFactor.Data.html#PortAddress"><span class="hs-identifier hs-var">PortAddress</span></a><span> </span><a name="local-6989586621679034552"><a href="#local-6989586621679034552"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MicroFactor.Data.html#Boolean"><span class="hs-identifier hs-var">Boolean</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034544"><span class="hs-identifier hs-var">comp</span></a><span> </span><a href="#local-6989586621679034551"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679034552"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-137"></a><span>        </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Instruction"><span class="hs-identifier hs-var">Instruction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;cannot compare Instructions&quot;</span><span>
</span><a name="line-138"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="MicroFactor.Data.html#Instruction"><span class="hs-identifier hs-var">Instruction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;cannot compare Instructions&quot;</span><span>
</span><a name="line-139"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><span class="hs-string">&quot;can only compare values of same type&quot;</span><span> </span><span class="hs-comment">-- tried show a with show b</span><span>
</span><a name="line-140"></a><span>
</span><a name="line-141"></a><span class="hs-identifier">interpretBinaryBool</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034516"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-142"></a><a name="interpretBinaryBool"><a href="MicroFactor.Interpreter.html#interpretBinaryBool"><span class="hs-identifier">interpretBinaryBool</span></a></a><span> </span><a name="local-6989586621679034553"><a href="#local-6989586621679034553"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-143"></a><span>    </span><a name="local-6989586621679034554"><a href="#local-6989586621679034554"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataBool"><span class="hs-identifier hs-var">popDataBool</span></a><span>
</span><a name="line-144"></a><span>    </span><a name="local-6989586621679034555"><a href="#local-6989586621679034555"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataBool"><span class="hs-identifier hs-var">popDataBool</span></a><span>
</span><a name="line-145"></a><span>    </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MicroFactor.Data.html#Boolean"><span class="hs-identifier hs-var">Boolean</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034553"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679034555"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679034554"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-identifier">interpretStack</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679034464"><a href="#local-6989586621679034464"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679034464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679034464"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034463"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-148"></a><a name="interpretStack"><a href="MicroFactor.Interpreter.html#interpretStack"><span class="hs-identifier">interpretStack</span></a></a><span> </span><a name="local-6989586621679034556"><a href="#local-6989586621679034556"><span class="hs-identifier">manip</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034557"><a href="#local-6989586621679034557"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-var">Thread</span></a><span> </span><span class="hs-special">{</span><a name="local-6989586621679034558"><a href="#local-6989586621679034558"><span class="hs-identifier">dataStack</span></a></a><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-149"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679034556"><span class="hs-identifier hs-var">manip</span></a><span> </span><a href="#local-6989586621679034558"><span class="hs-identifier hs-var">dataStack</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-150"></a><span>        </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679034559"><a href="#local-6989586621679034559"><span class="hs-identifier">dataStack</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679034557"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">{</span><a href="#local-6989586621679034559"><span class="hs-identifier hs-var">dataStack</span></a><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-151"></a><span>        </span><span class="hs-identifier hs-var">Nothing</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpreterFailResult"><span class="hs-identifier hs-var">interpreterFailResult</span></a><span> </span><a href="#local-6989586621679034557"><span class="hs-identifier hs-var">t</span></a><span> </span><a href="MicroFactor.Interpreter.html#StackUnderflow"><span class="hs-identifier hs-var">StackUnderflow</span></a><span>
</span><a name="line-152"></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-identifier">interpretBinaryInt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034462"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-155"></a><a name="interpretBinaryInt"><a href="MicroFactor.Interpreter.html#interpretBinaryInt"><span class="hs-identifier">interpretBinaryInt</span></a></a><span> </span><a name="local-6989586621679034560"><a href="#local-6989586621679034560"><span class="hs-identifier">op</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-156"></a><span>    </span><a name="local-6989586621679034561"><a href="#local-6989586621679034561"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInt"><span class="hs-identifier hs-var">popDataInt</span></a><span>
</span><a name="line-157"></a><span>    </span><a name="local-6989586621679034562"><a href="#local-6989586621679034562"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInt"><span class="hs-identifier hs-var">popDataInt</span></a><span>
</span><a name="line-158"></a><span>    </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MicroFactor.Data.html#Integer"><span class="hs-identifier hs-var">Integer</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034560"><span class="hs-identifier hs-var">op</span></a><span> </span><a href="#local-6989586621679034562"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679034561"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-159"></a><span>
</span><a name="line-160"></a><span class="hs-identifier">wrapper</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Data.html#MicroFactorInstruction"><span class="hs-identifier hs-type">MicroFactorInstruction</span></a><span> </span><a href="#local-6989586621679034461"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Data.html#MicroFactorInstruction"><span class="hs-identifier hs-type">MicroFactorInstruction</span></a><span> </span><a href="#local-6989586621679034461"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-161"></a><a name="wrapper"><a href="MicroFactor.Interpreter.html#wrapper"><span class="hs-identifier">wrapper</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Data.html#Literal"><span class="hs-identifier hs-var">Literal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="MicroFactor.Data.html#Instruction"><span class="hs-identifier hs-var">Instruction</span></a><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-identifier">wrapRef</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Data.html#InstructionRef"><span class="hs-identifier hs-type">InstructionRef</span></a><span> </span><a href="#local-6989586621679034460"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="MicroFactor.Data.html#MicroFactorInstruction"><span class="hs-identifier hs-type">MicroFactorInstruction</span></a><span> </span><a href="#local-6989586621679034460"><span class="hs-identifier hs-type">r</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Data.html#MicroFactorInstruction"><span class="hs-identifier hs-type">MicroFactorInstruction</span></a><span> </span><a href="#local-6989586621679034460"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-164"></a><a name="wrapRef"><a href="MicroFactor.Interpreter.html#wrapRef"><span class="hs-identifier">wrapRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#wrapper"><span class="hs-identifier hs-var">wrapper</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="MicroFactor.Data.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="MicroFactor.Data.html#makeRef"><span class="hs-identifier hs-var">makeRef</span></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- | Interpret a sequence of instructions on a thread.</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- Creates output and affects the thread, and can fail with an error.</span><span>
</span><a name="line-169"></a><span class="hs-identifier">interpret</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Data.html#InstructionRef"><span class="hs-identifier hs-type">InstructionRef</span></a><span> </span><a href="#local-6989586621679034459"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="MicroFactor.Data.html#MicroFactorInstruction"><span class="hs-identifier hs-type">MicroFactorInstruction</span></a><span> </span><a href="#local-6989586621679034459"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-type">Thread</span></a><span> </span><a href="#local-6989586621679034459"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-type">InterpreterResult</span></a><span> </span><a href="#local-6989586621679034459"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><a name="interpret"><a href="MicroFactor.Interpreter.html#interpret"><span class="hs-identifier">interpret</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">runInterpreter</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Data.html#InstructionRef"><span class="hs-identifier hs-type">InstructionRef</span></a><span> </span><a href="#local-6989586621679034458"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><a href="MicroFactor.Data.html#MicroFactorInstruction"><span class="hs-identifier hs-type">MicroFactorInstruction</span></a><span> </span><a href="#local-6989586621679034458"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-type">ThreadInterpreter</span></a><span> </span><a href="#local-6989586621679034458"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-174"></a><a name="interpreter"><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier">interpreter</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034563"><a href="#local-6989586621679034563"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679034563"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-175"></a><span>    </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-var">Thread</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">returnStack</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a href="#local-6989586621679034563"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>    </span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-var">Thread</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">returnStack</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="local-6989586621679034564"><a href="#local-6989586621679034564"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034565"><a href="#local-6989586621679034565"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">runInterpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MicroFactor.Data.html#resolveRef"><span class="hs-identifier hs-var">resolveRef</span></a><span> </span><a href="#local-6989586621679034564"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679034563"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">returnStack</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679034565"><span class="hs-identifier hs-var">rs</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-177"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a name="local-6989586621679034566"><a href="#local-6989586621679034566"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MicroFactor.Data.html#resolveRef"><span class="hs-identifier hs-var">resolveRef</span></a><span> </span><a href="#local-6989586621679034566"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-comment">-- tail call optimisation</span><span>
</span><a name="line-178"></a><span class="hs-comment">-- interpreter (Call r:is) = interpreter (resolveRef r) &gt;&gt; interpreter is -- does not make use of the retur stack, cannot be suspended properly</span><span>
</span><a name="line-179"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Call"><span class="hs-identifier hs-var">Call</span></a><span> </span><a name="local-6989586621679034567"><a href="#local-6989586621679034567"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034568"><a href="#local-6989586621679034568"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034569"><a href="#local-6989586621679034569"><span class="hs-identifier">t</span></a></a><span class="hs-glyph">@</span><a href="MicroFactor.Interpreter.html#Thread"><span class="hs-identifier hs-var">Thread</span></a><span> </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679034570"><a href="#local-6989586621679034570"><span class="hs-identifier">returnStack</span></a></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-180"></a><span>    </span><span class="hs-identifier">runInterpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="MicroFactor.Data.html#resolveRef"><span class="hs-identifier hs-var">resolveRef</span></a><span> </span><a href="#local-6989586621679034567"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679034569"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">returnStack</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Data.html#makeRef"><span class="hs-identifier hs-var">makeRef</span></a><span> </span><a href="#local-6989586621679034568"><span class="hs-identifier hs-var">is</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034570"><span class="hs-identifier hs-var">returnStack</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-181"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#Execute"><span class="hs-identifier hs-var">Execute</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034571"><a href="#local-6989586621679034571"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034572"><a href="#local-6989586621679034572"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034572"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034571"><span class="hs-identifier hs-var">is</span></a><span>
</span><a name="line-182"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlIf"><span class="hs-identifier hs-var">ControlIf</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034573"><a href="#local-6989586621679034573"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-183"></a><span>    </span><a name="local-6989586621679034574"><a href="#local-6989586621679034574"><span class="hs-identifier">else'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-184"></a><span>    </span><a name="local-6989586621679034575"><a href="#local-6989586621679034575"><span class="hs-identifier">then'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-185"></a><span>    </span><a name="local-6989586621679034576"><a href="#local-6989586621679034576"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataBool"><span class="hs-identifier hs-var">popDataBool</span></a><span>
</span><a name="line-186"></a><span>    </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679034576"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679034575"><span class="hs-identifier hs-var">then'</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679034574"><span class="hs-identifier hs-var">else'</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034573"><span class="hs-identifier hs-var">is</span></a><span>
</span><a name="line-187"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlWhen"><span class="hs-identifier hs-var">ControlWhen</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034577"><a href="#local-6989586621679034577"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-188"></a><span>    </span><a name="local-6989586621679034578"><a href="#local-6989586621679034578"><span class="hs-identifier">then'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-189"></a><span>    </span><a name="local-6989586621679034579"><a href="#local-6989586621679034579"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataBool"><span class="hs-identifier hs-var">popDataBool</span></a><span>
</span><a name="line-190"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679034579"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034578"><span class="hs-identifier hs-var">then'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034577"><span class="hs-identifier hs-var">is</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><a href="#local-6989586621679034577"><span class="hs-identifier hs-var">is</span></a><span>
</span><a name="line-191"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlUnless"><span class="hs-identifier hs-var">ControlUnless</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034580"><a href="#local-6989586621679034580"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-192"></a><span>    </span><a name="local-6989586621679034581"><a href="#local-6989586621679034581"><span class="hs-identifier">else'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-193"></a><span>    </span><a name="local-6989586621679034582"><a href="#local-6989586621679034582"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataBool"><span class="hs-identifier hs-var">popDataBool</span></a><span>
</span><a name="line-194"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679034582"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><a href="#local-6989586621679034580"><span class="hs-identifier hs-var">is</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679034581"><span class="hs-identifier hs-var">else'</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034580"><span class="hs-identifier hs-var">is</span></a><span>
</span><a name="line-195"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlForever"><span class="hs-identifier hs-var">ControlForever</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034583"><a href="#local-6989586621679034583"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-196"></a><span>    </span><a name="local-6989586621679034584"><a href="#local-6989586621679034584"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-197"></a><span>    </span><span class="hs-comment">-- interpreter $ repeat body</span><span>
</span><a name="line-198"></a><span>    </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034584"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="MicroFactor.Interpreter.html#wrapper"><span class="hs-identifier hs-var">wrapper</span></a><span> </span><a href="#local-6989586621679034584"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlForever"><span class="hs-identifier hs-var">ControlForever</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034583"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlLoop"><span class="hs-identifier hs-var">ControlLoop</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034585"><a href="#local-6989586621679034585"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-200"></a><span>    </span><a name="local-6989586621679034586"><a href="#local-6989586621679034586"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-201"></a><span>    </span><span class="hs-comment">{-- first attempt:
    let rep = wrapRef [wrapper body, Operator ControlLoop]
    interpreter (body : rep : Operator ControlWhen : is) -}</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679034587"><a href="#local-6989586621679034587"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#wrapRef"><span class="hs-identifier hs-var">wrapRef</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679034586"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679034587"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">,</span><span> </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlWhen"><span class="hs-identifier hs-var">ControlWhen</span></a><span class="hs-special">]</span><span>
</span><a name="line-205"></a><span>    </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034586"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034587"><span class="hs-identifier hs-var">rep</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlWhen"><span class="hs-identifier hs-var">ControlWhen</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034585"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlWhile"><span class="hs-identifier hs-var">ControlWhile</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034588"><a href="#local-6989586621679034588"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-207"></a><span>    </span><a name="local-6989586621679034589"><a href="#local-6989586621679034589"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-208"></a><span>    </span><a name="local-6989586621679034590"><a href="#local-6989586621679034590"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-209"></a><span>    </span><span class="hs-comment">{-- first attempt:
    let rep = wrapper [body, pred, rep, Operator ControlWhen]
    interpreter (pred : rep : Operator ControlWhen : is) -}</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679034591"><a href="#local-6989586621679034591"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#wrapRef"><span class="hs-identifier hs-var">wrapRef</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034589"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034592"><span class="hs-identifier hs-var">go</span></a><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>        </span><a name="local-6989586621679034592"><a href="#local-6989586621679034592"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679034590"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679034591"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">,</span><span> </span><a href="MicroFactor.Interpreter.html#wrapRef"><span class="hs-identifier hs-var">wrapRef</span></a><span> </span><a href="#local-6989586621679034588"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">,</span><span> </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlIf"><span class="hs-identifier hs-var">ControlIf</span></a><span class="hs-special">]</span><span>
</span><a name="line-214"></a><span>    </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><a href="#local-6989586621679034592"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-215"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlUntil"><span class="hs-identifier hs-var">ControlUntil</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034593"><a href="#local-6989586621679034593"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-216"></a><span>    </span><a name="local-6989586621679034594"><a href="#local-6989586621679034594"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-217"></a><span>    </span><a name="local-6989586621679034595"><a href="#local-6989586621679034595"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-218"></a><span>    </span><span class="hs-comment">{-- first attempt:
    let rep = wrapRef [body, pred, rep, Operator ControlUnless]
    interpreter (pred : rep : Operator ControlUnless : is) -}</span><span>
</span><a name="line-221"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679034596"><a href="#local-6989586621679034596"><span class="hs-identifier">rep</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="MicroFactor.Interpreter.html#wrapRef"><span class="hs-identifier hs-var">wrapRef</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034594"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034597"><span class="hs-identifier hs-var">go</span></a><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>        </span><a name="local-6989586621679034597"><a href="#local-6989586621679034597"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679034595"><span class="hs-identifier hs-var">pred</span></a><span class="hs-special">,</span><span> </span><a href="MicroFactor.Interpreter.html#wrapRef"><span class="hs-identifier hs-var">wrapRef</span></a><span> </span><a href="#local-6989586621679034593"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679034596"><span class="hs-identifier hs-var">rep</span></a><span class="hs-special">,</span><span> </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlIf"><span class="hs-identifier hs-var">ControlIf</span></a><span class="hs-special">]</span><span>
</span><a name="line-223"></a><span>    </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><a href="#local-6989586621679034597"><span class="hs-identifier hs-var">go</span></a><span>
</span><a name="line-224"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlDo"><span class="hs-identifier hs-var">ControlDo</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034598"><a href="#local-6989586621679034598"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-225"></a><span>    </span><a name="local-6989586621679034599"><a href="#local-6989586621679034599"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-226"></a><span>    </span><a name="local-6989586621679034600"><a href="#local-6989586621679034600"><span class="hs-identifier">pred</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-227"></a><span>    </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034599"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="MicroFactor.Interpreter.html#wrapper"><span class="hs-identifier hs-var">wrapper</span></a><span> </span><a href="#local-6989586621679034600"><span class="hs-identifier hs-var">pred</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="MicroFactor.Interpreter.html#wrapper"><span class="hs-identifier hs-var">wrapper</span></a><span> </span><a href="#local-6989586621679034599"><span class="hs-identifier hs-var">body</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034598"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlDip"><span class="hs-identifier hs-var">ControlDip</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034601"><a href="#local-6989586621679034601"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-229"></a><span>    </span><a name="local-6989586621679034602"><a href="#local-6989586621679034602"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-230"></a><span>    </span><a name="local-6989586621679034603"><a href="#local-6989586621679034603"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span>
</span><a name="line-231"></a><span>    </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034602"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="MicroFactor.Data.html#Literal"><span class="hs-identifier hs-var">Literal</span></a><span> </span><a href="#local-6989586621679034603"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034601"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlKeep"><span class="hs-identifier hs-var">ControlKeep</span></a><span class="hs-glyph">:</span><a name="local-6989586621679034604"><a href="#local-6989586621679034604"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-233"></a><span>    </span><a name="local-6989586621679034605"><a href="#local-6989586621679034605"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInstruction"><span class="hs-identifier hs-var">popDataInstruction</span></a><span>
</span><a name="line-234"></a><span>    </span><a name="local-6989586621679034606"><a href="#local-6989586621679034606"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span> </span><span class="hs-comment">-- TODO: getData</span><span>
</span><a name="line-235"></a><span>    </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><a href="#local-6989586621679034606"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-236"></a><span>    </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034605"><span class="hs-identifier hs-var">ref</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="MicroFactor.Data.html#Literal"><span class="hs-identifier hs-var">Literal</span></a><span> </span><a href="#local-6989586621679034606"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679034604"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span>
</span><a name="line-237"></a><span class="hs-identifier">interpreter</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679034607"><a href="#local-6989586621679034607"><span class="hs-identifier">i</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034608"><a href="#local-6989586621679034608"><span class="hs-identifier">is</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpreter"><span class="hs-identifier hs-var">interpreter</span></a><span> </span><a href="#local-6989586621679034608"><span class="hs-identifier hs-var">is</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679034607"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-238"></a><span>    </span><a href="MicroFactor.Data.html#Comment"><span class="hs-identifier hs-var">Comment</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-239"></a><span>    </span><a href="MicroFactor.Data.html#LiteralString"><span class="hs-identifier hs-var">LiteralString</span></a><span> </span><a name="local-6989586621679034609"><a href="#local-6989586621679034609"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034610"><a href="#local-6989586621679034610"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679034609"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679034610"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>    </span><a href="MicroFactor.Data.html#Literal"><span class="hs-identifier hs-var">Literal</span></a><span> </span><a name="local-6989586621679034611"><a href="#local-6989586621679034611"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><a href="#local-6989586621679034611"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-241"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#Debugger"><span class="hs-identifier hs-var">Debugger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TODO: output</span><span>
</span><a name="line-242"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ControlIte"><span class="hs-identifier hs-var">ControlIte</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-243"></a><span>        </span><a name="local-6989586621679034612"><a href="#local-6989586621679034612"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span>
</span><a name="line-244"></a><span>        </span><a name="local-6989586621679034613"><a href="#local-6989586621679034613"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span>
</span><a name="line-245"></a><span>        </span><a name="local-6989586621679034614"><a href="#local-6989586621679034614"><span class="hs-identifier">cond</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popDataBool"><span class="hs-identifier hs-var">popDataBool</span></a><span>
</span><a name="line-246"></a><span>        </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679034614"><span class="hs-identifier hs-var">cond</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679034613"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679034612"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-247"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicNot"><span class="hs-identifier hs-var">LogicNot</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#popDataBool"><span class="hs-identifier hs-var">popDataBool</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="MicroFactor.Data.html#Boolean"><span class="hs-identifier hs-var">Boolean</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">not</span><span>
</span><a name="line-248"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicNor"><span class="hs-identifier hs-var">LogicNor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryBool"><span class="hs-identifier hs-var">interpretBinaryBool</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034615"><a href="#local-6989586621679034615"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679034616"><a href="#local-6989586621679034616"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034615"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679034616"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-249"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicLt"><span class="hs-identifier hs-var">LogicLt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretCompare"><span class="hs-identifier hs-var">interpretCompare</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;</span><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicGt"><span class="hs-identifier hs-var">LogicGt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretCompare"><span class="hs-identifier hs-var">interpretCompare</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-251"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicXor"><span class="hs-identifier hs-var">LogicXor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretCompare"><span class="hs-identifier hs-var">interpretCompare</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">/=</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Neq</span><span>
</span><a name="line-252"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicNand"><span class="hs-identifier hs-var">LogicNand</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryBool"><span class="hs-identifier hs-var">interpretBinaryBool</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679034617"><a href="#local-6989586621679034617"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679034618"><a href="#local-6989586621679034618"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034617"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679034618"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicAnd"><span class="hs-identifier hs-var">LogicAnd</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryBool"><span class="hs-identifier hs-var">interpretBinaryBool</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;&amp;</span><span class="hs-special">)</span><span>
</span><a name="line-254"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicXnor"><span class="hs-identifier hs-var">LogicXnor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretCompare"><span class="hs-identifier hs-var">interpretCompare</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Eq</span><span>
</span><a name="line-255"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicLte"><span class="hs-identifier hs-var">LogicLte</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretCompare"><span class="hs-identifier hs-var">interpretCompare</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;=</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Impl</span><span>
</span><a name="line-256"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicGte"><span class="hs-identifier hs-var">LogicGte</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretCompare"><span class="hs-identifier hs-var">interpretCompare</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;=</span><span class="hs-special">)</span><span>
</span><a name="line-257"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#LogicOr"><span class="hs-identifier hs-var">LogicOr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryBool"><span class="hs-identifier hs-var">interpretBinaryBool</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">||</span><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#StackNip"><span class="hs-identifier hs-var">StackNip</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretStack"><span class="hs-identifier hs-var">interpretStack</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><a name="local-6989586621679034619"><a href="#local-6989586621679034619"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-glyph">:</span><a name="local-6989586621679034620"><a href="#local-6989586621679034620"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034619"><span class="hs-identifier hs-var">d</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034620"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-259"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#StackDrop"><span class="hs-identifier hs-var">StackDrop</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-260"></a><span>    </span><span class="hs-comment">-- Operator StackPick</span><span>
</span><a name="line-261"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#StackDuplicate"><span class="hs-identifier hs-var">StackDuplicate</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretStack"><span class="hs-identifier hs-var">interpretStack</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><a name="local-6989586621679034621"><a href="#local-6989586621679034621"><span class="hs-identifier">d</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034622"><a href="#local-6989586621679034622"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034621"><span class="hs-identifier hs-var">d</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034621"><span class="hs-identifier hs-var">d</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034622"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- pick 0</span><span>
</span><a name="line-262"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#StackOver"><span class="hs-identifier hs-var">StackOver</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretStack"><span class="hs-identifier hs-var">interpretStack</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><a name="local-6989586621679034623"><a href="#local-6989586621679034623"><span class="hs-identifier">d1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034624"><a href="#local-6989586621679034624"><span class="hs-identifier">d2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034625"><a href="#local-6989586621679034625"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034624"><span class="hs-identifier hs-var">d2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034623"><span class="hs-identifier hs-var">d1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034624"><span class="hs-identifier hs-var">d2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034625"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- pick 1</span><span>
</span><a name="line-263"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#StackTuck"><span class="hs-identifier hs-var">StackTuck</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretStack"><span class="hs-identifier hs-var">interpretStack</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><a name="local-6989586621679034626"><a href="#local-6989586621679034626"><span class="hs-identifier">d1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034627"><a href="#local-6989586621679034627"><span class="hs-identifier">d2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034628"><a href="#local-6989586621679034628"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034626"><span class="hs-identifier hs-var">d1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034627"><span class="hs-identifier hs-var">d2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034626"><span class="hs-identifier hs-var">d1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034628"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-264"></a><span>    </span><span class="hs-comment">-- Operator StackRoll</span><span>
</span><a name="line-265"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#StackSwap"><span class="hs-identifier hs-var">StackSwap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretStack"><span class="hs-identifier hs-var">interpretStack</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><a name="local-6989586621679034629"><a href="#local-6989586621679034629"><span class="hs-identifier">d1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034630"><a href="#local-6989586621679034630"><span class="hs-identifier">d2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034631"><a href="#local-6989586621679034631"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034630"><span class="hs-identifier hs-var">d2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034629"><span class="hs-identifier hs-var">d1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034631"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- roll 1</span><span>
</span><a name="line-266"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#StackRotate"><span class="hs-identifier hs-var">StackRotate</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretStack"><span class="hs-identifier hs-var">interpretStack</span></a><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span> </span><a name="local-6989586621679034632"><a href="#local-6989586621679034632"><span class="hs-identifier">d1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034633"><a href="#local-6989586621679034633"><span class="hs-identifier">d2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034634"><a href="#local-6989586621679034634"><span class="hs-identifier">d3</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679034635"><a href="#local-6989586621679034635"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679034634"><span class="hs-identifier hs-var">d3</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034632"><span class="hs-identifier hs-var">d1</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034633"><span class="hs-identifier hs-var">d2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679034635"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- roll 2</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ArithAdd"><span class="hs-identifier hs-var">ArithAdd</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryInt"><span class="hs-identifier hs-var">interpretBinaryInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-special">)</span><span>
</span><a name="line-269"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ArithSub"><span class="hs-identifier hs-var">ArithSub</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryInt"><span class="hs-identifier hs-var">interpretBinaryInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ArithMul"><span class="hs-identifier hs-var">ArithMul</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryInt"><span class="hs-identifier hs-var">interpretBinaryInt</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ArithDiv"><span class="hs-identifier hs-var">ArithDiv</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryInt"><span class="hs-identifier hs-var">interpretBinaryInt</span></a><span> </span><span class="hs-identifier hs-var">div</span><span>
</span><a name="line-272"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ArithMod"><span class="hs-identifier hs-var">ArithMod</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryInt"><span class="hs-identifier hs-var">interpretBinaryInt</span></a><span> </span><span class="hs-identifier hs-var">mod</span><span>
</span><a name="line-273"></a><span>    </span><span class="hs-comment">-- Operator ArithDivmod -&gt; interpretBinaryInt</span><span>
</span><a name="line-274"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ArithAbs"><span class="hs-identifier hs-var">ArithAbs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#pushData"><span class="hs-identifier hs-var">pushData</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="MicroFactor.Data.html#Integer"><span class="hs-identifier hs-var">Integer</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-identifier hs-var">abs</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#popDataInt"><span class="hs-identifier hs-var">popDataInt</span></a><span>
</span><a name="line-275"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ArithMax"><span class="hs-identifier hs-var">ArithMax</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryInt"><span class="hs-identifier hs-var">interpretBinaryInt</span></a><span> </span><span class="hs-identifier hs-var">max</span><span>
</span><a name="line-276"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#ArithMin"><span class="hs-identifier hs-var">ArithMin</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#interpretBinaryInt"><span class="hs-identifier hs-var">interpretBinaryInt</span></a><span> </span><span class="hs-identifier hs-var">min</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span>    </span><a href="MicroFactor.Data.html#Operator"><span class="hs-identifier hs-var">Operator</span></a><span> </span><a href="MicroFactor.Data.html#Send"><span class="hs-identifier hs-var">Send</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-279"></a><span>        </span><a name="local-6989586621679035148"><a href="#local-6989586621679035148"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="MicroFactor.Interpreter.html#popData"><span class="hs-identifier hs-var">popData</span></a><span>
</span><a name="line-280"></a><span>        </span><a href="MicroFactor.Interpreter.html#ThreadInterpreter"><span class="hs-identifier hs-var">ThreadInterpreter</span></a><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679035149"><a href="#local-6989586621679035149"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="MicroFactor.Interpreter.html#InterpreterResult"><span class="hs-identifier hs-var">InterpreterResult</span></a><span> </span><span class="hs-special">[</span><a href="MicroFactor.Interpreter.html#showValue"><span class="hs-identifier hs-var">showValue</span></a><span> </span><a href="#local-6989586621679035148"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">]</span><span> </span><a href="#local-6989586621679035149"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><span>
</span><a name="line-282"></a><span class="hs-comment">-- | shortened representation of `TaggedValue`s</span><span>
</span><a name="line-283"></a><span class="hs-identifier">showValue</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="MicroFactor.Data.html#TaggedValue"><span class="hs-identifier hs-type">TaggedValue</span></a><span> </span><a href="#local-6989586621679034457"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-284"></a><a name="showValue"><a href="MicroFactor.Interpreter.html#showValue"><span class="hs-identifier">showValue</span></a></a><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Boolean"><span class="hs-identifier hs-var">Boolean</span></a><span> </span><a name="local-6989586621679035150"><a href="#local-6989586621679035150"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679035150"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-285"></a><span class="hs-identifier">showValue</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Integer"><span class="hs-identifier hs-var">Integer</span></a><span> </span><a name="local-6989586621679035151"><a href="#local-6989586621679035151"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679035151"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-286"></a><span class="hs-identifier">showValue</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#PortAddress"><span class="hs-identifier hs-var">PortAddress</span></a><span> </span><a name="local-6989586621679035152"><a href="#local-6989586621679035152"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-char">'#'</span><span class="hs-glyph">:</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679035152"><span class="hs-identifier hs-var">w</span></a><span>
</span><a name="line-287"></a><span class="hs-identifier">showValue</span><span> </span><span class="hs-special">(</span><a href="MicroFactor.Data.html#Instruction"><span class="hs-identifier hs-var">Instruction</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;Code&gt;&quot;</span></pre></body></html>